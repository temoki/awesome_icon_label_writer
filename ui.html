<p id="message"></p>
<button id="ok">OK</button>
<button id="cancel">Cancel</button>
<script>
    var lastPluginMessage = { type: 'none' }

    document.getElementById('ok').onclick = () => {
        switch (lastPluginMessage.type) {
            case 'renamable-nodes-found':
                if (lastPluginMessage.renamableNodes.length > 0) {
                    parent.postMessage({ pluginMessage: { type: 'rename', renamableNodes: lastPluginMessage.renamableNodes } }, '*')
                } else {
                    parent.postMessage({ pluginMessage: { type: 'exit' } }, '*')
                }
                break

            case 'renamed':
                parent.postMessage({ pluginMessage: { type: 'exit' } }, '*')
                break

            default:
        }
    }

    document.getElementById('cancel').onclick = () => {
        parent.postMessage({ pluginMessage: { type: 'exit' } }, '*')
    }

    onmessage = (event) => {
        const messageText = document.getElementById('message')
        const okButton = document.getElementById('ok')
        const cancelButton = document.getElementById('cancel')

        const pluginMessage = event.data.pluginMessage
        switch (pluginMessage.type) {
            case 'renamable-nodes-found':
                const foundCount = pluginMessage.renamableNodes.length
                const target = pluginMessage.isSelectionMode ? 'selection' : 'current page'

                if (foundCount >= 2) {
                    messageText.innerText = `${pluginMessage.renamableNodes.length} text nodes consisting of one Font Awesome icon were found in the ${target}.`
                    messageText.innerText += '\nAre you sure you want to change the node name to the icon name?'
                } else if (foundCount == 1) {
                    messageText.innerText = `A text node consisting of one Font Awesome icon was found in the ${target}.`
                    messageText.innerText += '\nAre you sure you want to change these node name to the icon name?'
                } else {
                    messageText.innerText = `No text nodes consisting of one Font Awesome icon were found in the ${target}.`
                }

                okButton.style.visibility = 'visible'
                cancelButton.style.visibility = (foundCount > 0) ? 'visible' : 'hidden'
                break

            case 'renamed':
                messageText.innerText = `Renamed ${pluginMessage.count} text nodes.`
                okButton.style.visibility = 'visible'
                cancelButton.style.visibility = 'hidden'
                break

            default:
        }
        lastPluginMessage = pluginMessage
    }
</script>